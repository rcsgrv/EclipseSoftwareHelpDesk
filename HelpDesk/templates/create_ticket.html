{% extends "base.html" %}
{% block title %}Create Ticket{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow-sm" style="max-width: 600px; margin: 0 auto; border: none;">
    <div class="card-header text-white text-center" style="background-color: #4C6C85;">
      <h3 class="mb-0">Create New Ticket</h3>
    </div>

    <div class="card-body p-4">
      <form method="POST">
        <!-- Ticket Type -->
        <div class="mb-3">
          <label for="ticket_type" class="form-label fw-semibold px-2 mb-1">Ticket Type<span 
                 class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                 title="Please select the type of ticket that you want to create"> *</span></label>
          <select class="form-select" id="ticket_type" name="ticket_type" required>
            {% for t in ['Support Request', 'Feature Request', 'Bug Report'] %}
              <option value="{{ t }}" {% if (ticket_type | default('Support Request')) == t %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Subject -->
        <div class="mb-3">
          <label for="subject" class="form-label fw-semibold px-2 mb-1">Subject<span 
                 class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                 title="Please provide a concise title or summary of your issue or request"> *</span></label>
          <input 
            type="text" 
            class="form-control" 
            id="subject" 
            name="subject" 
            value="{{ subject | default('') }}">
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label for="description" class="form-label fw-semibold px-2 mb-1">Description<span 
                 class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                 title="Please provide a detailed description of your issue or request"> *</span></label>
          <textarea 
              class="form-control" 
              id="description" 
              name="description" 
              style="resize: none;"
              rows="3">{{ description | default('') }}</textarea>
        </div>

        {% if current_user.is_admin %}
          <!-- Status -->
          <div class="mb-3">
            <label for="status" class="form-label fw-semibold px-2 mb-1">Status<span 
                   class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                   title="Please select a status for the ticket."> *</span></label>
                <select class="form-select" name="status"> 
                {% for s in ['Open', 'In Progress', 'On Hold / Pending', 'Resolved', 'Closed'] %}
                    <option value="{{ s }}" {% if (status | default('Open')) == s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
                </select>
            </div>

          <!-- Priority -->
          <div class="mb-3">
            <label for="priority" class="form-label fw-semibold px-2 mb-1">Priority<span 
                   class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                   title="Please select a priority level for the ticket."> *</span></label>
                <select class="form-select" name="status">
                {% for p in ['Low', 'Normal', 'High'] %}
                    <option value="{{ p }}" {% if (priority | default('Normal')) == p %}selected{% endif %}>{{ p }}</option>
                {% endfor %}
                </select>
            </div>

          <!-- Estimated Time -->
          <div class="mb-3">
            <label for="estimated_time" class="form-label fw-semibold px-2 mb-1">Estimated Time (hours)<span 
                   class="text-danger" data-bs-toggle="tooltip" data-bs-placement="left" 
                   title="Please provide an estimate for how long it will take to action this ticket."> *</span></label>
            <input type="number" 
                   class="form-control" 
                   id="estimated_time" 
                   name="estimated_time"
                   step="any"
                   value="{{ estimated_time | default('4') }}">
          </div>
        {% else %}
          <input type="hidden" name="status" value="{{ status | default('Open') }}">
          <input type="hidden" name="priority" value="{{ priority | default('Normal') }}">
          <input type="hidden" name="estimated_time" value="{{ estimated_time | default('4') }}">
        {% endif %}

        <div class="d-flex justify-content-end gap-2 mt-4">
            <a href="{{ url_for('home.home') }}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn text-white" style="background-color: #4C6C85;">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}